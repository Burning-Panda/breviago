{{ define "views/acronyms" }}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} - {{ .GetAppName }}</title>
    <link rel="stylesheet" href="/public/css/reset.css">
    <link rel="stylesheet" href="/public/css/test.css">
    <link rel="stylesheet" href="/public/css/main.css">
</head>

<body data-theme="dark">
    <div class="app-container">
        <nav class="navbar">
            <div class="navbar-content">
                <div class="navbar-brand">
                    <button class="btn btn-icon">
                        <i class="ph ph-list"></i>
                    </button>
                    <div class="navbar-brand">
                        <img src="/public/images/logo.png" alt="Breviago" class="navbar-logo">
                        <h1 class="navbar-title">Breviago</h1>
                    </div>
                </div>
                <div class="navbar-search">
                    <input type="text" class="search-input" placeholder="Search acronyms...">
                    <i class="ph ph-magnifying-glass"></i>
                </div>
                <div class="navbar-actions">
                    <button class="btn btn-primary">
                        <i class="ph ph-plus"></i>
                        <span>New</span>
                    </button>
                    <button class="btn btn-icon" onclick="swapTheme()">
                        <i id="color-mode-toggle" class="ph ph-sun"></i>
                    </button>
                    <button class="btn btn-icon">
                        <i class="ph ph-gear"></i>
                    </button>
                    <div class="user-profile">
                        <button class="btn user-profile-button" type="button" onclick="toggleUserProfileDropdown()">
                            <img src="https://images.pexels.com/photos/415829/pexels-photo-415829.jpeg?cs=srgb&fm=jpg&w=250"
                                alt="John Doe" class="profile-image">
                        </button>

                        <div id="user-profile-dropdown" class="user-profile-dropdown" data-visible="false">
                            <button class="btn">
                                <i class="ph ph-user"></i>
                                <span>Profile</span>
                            </button>
                            <button class="btn">
                                <i class="ph ph-gear"></i>
                                <span>Settings</span>
                            </button>
                            <button class="btn">
                                <i class="ph ph-sign-out"></i>
                                <span>Logout</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="main-content">
            <aside class="sidebar">
                <div class="sidebar-content">
                    <a href="/acronyms" class="sidebar-item">
                        <i class="ph ph-house sidebar-item-icon"></i>
                        <span>All Acronyms</span>
                    </a>
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <div class="sidebar-item">
                                <i class="ph ph-tag sidebar-item-icon"></i>
                                <h3>Tags</h3>
                                <i class="ph ph-caret-down"></i>
                            </div>
                        </div>
                        <div class="acronym-tags">
                            <button class="acronym-tag">backend</button>
                            <button class="acronym-tag">business</button>
                            <button class="acronym-tag">database</button>
                            <button class="acronym-tag">design</button>
                            <button class="acronym-tag">devops</button>
                            <button class="acronym-tag">frontend</button>
                            <button class="acronym-tag">healthcare</button>
                            <button class="acronym-tag">infrastructure</button>
                            <button class="acronym-tag">management</button>
                            <button class="acronym-tag">programming</button>
                            <button class="acronym-tag">software</button>
                            <button class="acronym-tag">technology</button>
                            <button class="acronym-tag">web</button>
                        </div>
                    </div>

                </div>
            </aside>

            <main class="content-container">
                <div class="acronym-list">
                    <div class="acronym-list-header">
                        <div class="acronym-list-title">
                            <h2>Acronyms</h2>
                            <span class="acronym-list-count">8 items</span>
                        </div>
                        <div class="acronym-list-actions">
                            <button class="btn btn-icon">
                                <i class="ph ph-funnel"></i>
                            </button>
                            <button class="btn btn-icon">
                                <i class="ph ph-download-simple"></i>
                            </button>
                            <button class="btn btn-primary" onclick="newAcronym()">
                                <i class="ph ph-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="acronym-items">
                        {{ range .Acronyms }}
                        {{ template "components/AcronymItem" . }}
                        {{ end }}
                    </div>
                </div>

                <div id="acronym-details-default" class="acronym-details" aria-hidden="false">
                    {{ template "components/AcronymListNoContent" . }}
                </div>
                <div id="acronym-details" class="acronym-details" aria-hidden="true" data-visible="false">
                    {{ template "components/AcronymContent" . }}
                </div>
            </main>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay" data-visible="false"></div>

    <div id="new-acronym-modal" class="modal" data-visible="false">
        <div class="modal-header">
            <h2>New Acronym</h2>
            <button class="btn btn-icon" aria-label="Close Acronym Details" onclick="closeAcronymModal()">
                <i class="ph ph-x"></i>
            </button>
        </div>
        <div class="modal-content">
            <form action="" method="post" id="new-acronym-form">

                <fieldset id="acronym-input-fieldset">
                    <label for="acronym-input">Acronym</label>
                    <input type="text" id="acronym-input" placeholder="Acronym">
                </fieldset>
                <fieldset id="acronym-meaning-fieldset">
                    <label for="acronym-input">Meaning</label>
                    <input type="text" id="acronym-input" placeholder="Meaning">
                </fieldset>
                <fieldset id="acronym-description-fieldset">
                    <label for="acronym-input">Description</label>
                    <textarea id="acronym-input" placeholder="Description"></textarea>
                </fieldset>
                <fieldset id="acronym-tags-fieldset">
                    <label for="acronym-tags">Tags</label>
                    <select id="acronym-tags" multiple>
                        <option value="backend">Backend</option>
                        <option value="business">Business</option>
                        <option value="database">Database</option>
                        <option value="design">Design</option>
                        <option value="devops">DevOps</option>
                    </select>
                </fieldset>
                <fieldset id="acronym-related-fieldset">
                    <label for="acronym-input">Related Acronyms</label>
                    <input type="text" id="acronym-input" placeholder="Related Acronyms">
                </fieldset>

                <fieldset><button class="btn btn-primary" type="submit">Create</button></fieldset>
            </form>
        </div>
    </div>

    <!-- The Delete Modal -->
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h2>Delete Acronym</h2>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this acronym?</p>
            <p>This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" type="submit">Delete</button>
            <button class="btn btn-secondary" type="button">Cancel</button>
        </div>
    </div>

    <script src="https://unpkg.com/htmx.org@2.0.4"></script>

    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css" />
    <link rel="stylesheet" type="text/css"
        href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" />

    <script>
        function swapTheme() {
            const body = document.body;
            body.dataset.theme = body.dataset.theme === 'dark' ? 'light' : 'dark';

            const colorModeToggle = document.getElementById('color-mode-toggle');
            colorModeToggle.classList.toggle('ph-sun', body.dataset.theme === 'dark');
            colorModeToggle.classList.toggle('ph-moon', body.dataset.theme === 'light');
        }

        function toggleUserProfileDropdown() {
            const userProfileDropdown = document.getElementById('user-profile-dropdown');
            userProfileDropdown.dataset.visible = userProfileDropdown.dataset.visible === 'true' ? 'false' : 'true';
        }

        // Get user's timezone and store it in a data attribute
        document.addEventListener('DOMContentLoaded', function () {
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            document.body.dataset.timezone = timezone;

            // Update all acronym items with the timezone
            document.querySelectorAll('.acronym-item').forEach(item => {
                const currentHref = item.getAttribute('hx-get');
                if (currentHref) {
                    item.setAttribute('hx-get', currentHref + '?timezone=' + encodeURIComponent(timezone));
                }
            });
        });

        function showAcronymDetails() {
            const acronymDetails = document.getElementById('acronym-details');
            const acronymDetailsEmpty = document.getElementById('acronym-details-default');
            acronymDetails.setAttribute('aria-hidden', 'false');
            acronymDetailsEmpty.setAttribute('aria-hidden', 'true');
        }

        function hideAcronymDetails() {
            const acronymDetails = document.getElementById('acronym-details');
            const acronymDetailsEmpty = document.getElementById('acronym-details-default');
            acronymDetails.setAttribute('aria-hidden', 'true');
            acronymDetailsEmpty.setAttribute('aria-hidden', 'false');
        }

        function editAcronym(uuid) {
            const content = document.querySelector('.acronym-details-content');
            const editableFields = content.querySelectorAll('[data-editable]');

            // Toggle edit mode
            const isEditing = content.dataset.editing === 'true';
            content.dataset.editing = !isEditing;

            editableFields.forEach(field => {
                if (!isEditing) {
                    // Enter edit mode
                    const originalContent = field.textContent;
                    field.innerHTML = `<input type="text" class="edit-input" value="${originalContent}" data-original="${originalContent}">`;
                } else {
                    // Save changes
                    const input = field.querySelector('input');
                    if (input) {
                        const newValue = input.value;
                        field.textContent = newValue;

                        // Send update to server
                        fetch(`/acronyms/${uuid}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                [field.dataset.field]: newValue
                            })
                        });
                    }
                }
            });
        }

        function deleteAcronym(uuid) {
            console.log(uuid);
        }

        function newAcronym() {
            const newAcronymModal = document.getElementById('new-acronym-modal');
            const modalOverlay = document.getElementById('modal-overlay');
            newAcronymModal.dataset.visible = 'true';
            newAcronymModal.dataset.hidden = 'false';
            modalOverlay.dataset.visible = 'true';
        }

        function closeAcronymModal() {
            const newAcronymModal = document.getElementById('new-acronym-modal');
            const modalOverlay = document.getElementById('modal-overlay');
            newAcronymModal.dataset.visible = 'false';
            newAcronymModal.dataset.hidden = 'true';
            modalOverlay.dataset.visible = 'false';
        }

        // Add event listener for mouse click on modal-overlay
        document.addEventListener('click', function (event) {
            if (event.target === document.getElementById('modal-overlay')) {
                closeAcronymModal();
            }
        });

        window.matchMedia('(prefers-color-scheme: dark)').addListener(function (event) {
            if (event.matches) {
                document.body.dataset.theme = 'dark';
            } else {
                document.body.dataset.theme = 'light';
            }
        });
    </script>

</body>

</html>
{{ end }}

{{ define "components/AcronymContent"}}
<div class="acronym-details-header">
    <h2 class="acronym-details-title">Acronym Details</h2>
    <div class="acronym-details-actions">
        <button class="btn btn-icon" aria-label="Share Acronym {{ .Acronym.Acronym }}">
            <i class="ph ph-share"></i>
        </button>
        <button class="btn btn-icon" aria-label="Edit Acronym {{ .Acronym.Acronym }}"
            onclick="editAcronym('{{ .Acronym.UUID }}')">
            <i class="ph ph-pen"></i>
        </button>
        <button class="btn btn-icon btn-danger" aria-label="Delete Acronym {{ .Acronym.Acronym }}"
            hx-delete="/acronyms/{{ .Acronym.UUID }}">
            <i class="ph ph-trash"></i>
        </button>
        <button class="btn btn-icon" aria-label="Close Acronym Details" onclick="hideAcronymDetails()">
            <i class="ph ph-x"></i>
        </button>
    </div>
</div>
<div class="acronym-details-content">
    {{ if .Acronym }}
    <div class="acronym-details-main">
        <div class="acronym-details-header-content">
            <h2 class="acronym-details-name" data-editable="true" data-field="acronym">{{ .Acronym.Acronym }}</h2>
        </div>
        <h3 class="acronym-details-full-name" data-editable="true" data-field="meaning">{{ .Acronym.Meaning }}</h3>
        <div class="acronym-details-description">
            <h3 class="acronym-details-description-title">Description</h3>
            <p class="acronym-details-description-text" data-editable="true" data-field="description">{{
                .Acronym.Description }}</p>
        </div>
        {{ if .Acronym.Labels }}
        <div class="acronym-details-tags">
            <h3 class="acronym-details-tags-title">Tags</h3>
            <div class="acronym-details-tags-list">
                {{ range .Acronym.Labels }}
                <span class="acronym-details-tag">{{ .Label }}</span>
                {{ end }}
            </div>
        </div>
        {{ end }}
        <div class="acronym-details-meta">
            <div class="acronym-details-meta-grid">
                <div class="acronym-details-meta-item">
                    <i class="ph ph-calendar acronym-details-meta-icon"></i>
                    <div>
                        <p>Created: {{ .Acronym.CreatedAt.Format "2006-01-02 15:04:05" }}</p>
                        <p>Updated: {{ .Acronym.UpdatedAt.Format "2006-01-02 15:04:05" }}</p>
                    </div>
                </div>
                {{/*
                <!-- TODO: Created by
                 <div class="acronym-details-meta-item">
                    <i class="ph ph-user acronym-details-meta-icon"></i>
                    <p>Created by: {{ .Acronym.Owner }}</p>
                </div>
                 -->
                */}}
            </div>
        </div>
    </div>

    <div class="acronym-details-notes">
        <h3 class="acronym-details-notes-title">Notes</h3>
        <div class="acronym-details-notes-list">
            {{ range .Acronym.Notes }}
            <div class="acronym-details-note">
                <div class="acronym-details-note-header">
                    <span class="acronym-details-note-author">
                        <i class="ph ph-user"></i> {{ .User.Name }}
                    </span>
                    <span class="acronym-details-note-date">
                        {{ .CreatedAt.Format "Jan 2, 2006 15:04" }}
                    </span>
                </div>
                <p class="acronym-details-note-text">{{ .Note }}</p>
            </div>
            {{ end }}
        </div>
    </div>

    <div class="acronym-details-history">
        <h3 class="acronym-details-history-title">History</h3>
        <div class="acronym-details-history-list">
            {{ range .Acronym.Revisions }}
            <div class="acronym-details-history-item">
                <p class="acronym-details-history-item-text"><s>{{ .OldValue }}</s> {{ .NewValue }}</p>
                <p class="acronym-details-history-item-text" aria-label="">{{ .Action }}</p>
            </div>
            {{ end }}
        </div>
        {{ else }}
        {{ template "components/AcronymListNoContent" . }}
        {{ end }}
    </div>
</div>
{{ end }}

{{ define "components/AcronymListNoContent"}}
<div class="acronym-no-content">
    <div class="acronym-no-content-box">
        <h3 class="acronym-no-content-title">No acronym selected</h3>
        <p class="acronym-no-content-description">Select an acronym from the list to view its details or create a
            new one to get started.</p><button class="acronym-no-content-button" type="button" onclick="newAcronym()">
            <i class="ph ph-plus"></i>
            Create new acronym</button>
    </div>
</div>
{{ end }}
